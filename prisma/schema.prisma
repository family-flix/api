generator client {
        provider = "prisma-client-js"
}

datasource db {
        provider = "sqlite"
        url      = env("DATABASE_PATH")
}

model drive {
        id               String  @id
        created          String  @default("")
        updated          String  @default("")
        // 网盘名称（备注）
        name             String? @default("")
        // 阿里云对网盘的唯一标志，每次请求都需要带上该参数
        drive_id         String? @default("")
        // 阿里云对网盘在该设备下的id？
        device_id        String? @default("")
        // 网盘 user_id
        aliyun_user_id   String? @default("")
        // 网盘提供的名称
        user_name        String? @default("")
        // 网盘提供的名称
        nick_name        String? @default("")
        // 网盘提供的头像
        avatar           String? @default("")
        // 网盘提供的
        app_id           String? @default("")
        // 总大小
        total_size       Float?  @default(0)
        // 已使用
        used_size        Float?  @default(0)
        // 是否禁用
        invalid          Float?  @default(0)
        // 最近一次索引该网盘的时间
        latest_analysis  String? @default("")
        // 网盘用于存放影视剧的目录
        root_folder_name String? @default("")
        // 网盘用于存放影视剧的目录 file_id
        root_folder_id   String? @default("")
        // 属于哪个用户
        user_id          String? @default("")

        @@index([created])
}

model drive_token {
        id            String  @id
        created       String  @default("")
        updated       String  @default("")
        access_token  String? @default("")
        refresh_token String? @default("")
        expired_at    String? @default("")
        // 关联 drive 表
        drive_id      String? @default("")

        @@index([created])
}

model async_task {
        id             String  @id
        created        String  @default("")
        updated        String  @default("")
        status         String? @default("")
        error_messages String? @default("")
        unique_id      String? @default("")
        desc           String? @default("")
        need_stop      Float?  @default(0)
        // 关联 user 表
        user_id        String? @default("")

        @@index([created])
}

model drive_analysis {
        id       String  @id
        created  String  @default("")
        updated  String  @default("")
        drive_id String? @default("")

        @@index([created])
}

model drive_check_in {
        id         String  @id
        created    String  @default("")
        updated    String  @default("")
        // 签到时间
        checked_at String? @default("")
        // 关联 drive 表
        drive_id   String? @default("")

        @@index([created])
}

model episode {
        id             String  @id
        created        String  @default("")
        updated        String  @default("")
        // 第几集
        episode        String? @default("")
        // 第几季
        season         String? @default("")
        // 网盘文件信息
        file_id        String? @default("")
        file_name      String? @default("")
        parent_file_id String? @default("")
        parent_paths   String? @default("")
        size           Float?  @default(0)
        // 关联 tv 表
        tv_id          String? @default("")
        // 关联 drive 表
        drive_id       String? @default("")
        // 关联 user 表
        user_id        String? @default("")

        @@index([created])
}

model folder {
        id             String  @id
        created        String  @default("")
        updated        String  @default("")
        // 文件 id
        file_id        String? @default("")
        // 文件名称
        name           String? @default("")
        // 父文件夹 file_id
        parent_file_id String? @default("")
        // 0文件夹 1文件
        type           Float?  @default(0)
        // 文件大小
        size           Float?  @default(0)
        // 关联 drive 表
        drive_id       String? @default("")
        // 关联 user 表
        user_id        String? @default("")

        @@index([created])
}

model log {
        id      String  @id
        created String  @default("")
        updated String  @default("")
        title   String? @default("")

        @@index([created])
}

model member {
        id       String  @id
        created  String  @default("")
        updated  String  @default("")
        // 成员邮箱
        email    String? @default("")
        // 成员名字
        name     String? @default("")
        // 成员备注
        remark   String? @default("")
        // 是否禁用
        disabled Float?  @default(0)
        // 关联 user 表
        owner_id String? @default("")

        @@index([created])
}

model member_token {
        id         String  @id
        created    String  @default("")
        updated    String  @default("")
        // 成员授权凭证
        token      String? @default("")
        // 该 token 是否被使用
        used       Float?  @default(0)
        // 过期时间
        expired_at String? @default("")
        // 关联 member 表
        member_id  String? @default("")

        @@index([created])
}

model movie {
        id                String  @id
        created           String  @default("")
        updated           String  @default("")
        // 电影名称
        name              String? @default("")
        // 电影原始名称/外文名称
        original_name     String? @default("")
        // 关联 user 表
        user_id           String? @default("")
        // 关联 drive 表
        drive_id          String? @default("")
        // 关联 searched_movie 表
        searched_movie_id String? @default("")

        @@index([created])
}

model play_history {
        id           String  @id
        created      String  @default("")
        updated      String  @default("")
        // 当前播放的影片总时长
        duration     Float?  @default(0)
        // 当前播放进度
        current_time Float?  @default(0)
        // 关联 episode 表
        episode_id   String? @default("")
        // 关联 member 表
        member_id    String? @default("")
        // 关联 tv 表
        tv_id        String? @default("")
        // 关联 movie 表
        movie_id     String? @default("")

        @@index([created])
}

model recommended_tv {
        id        String  @id
        created   String  @default("")
        updated   String  @default("")
        sort      Float?  @default(0)
        tv_id     String? @default("")
        member_id String? @default("")

        @@index([created])
}

model searched_season {
        id             String  @id
        created        String  @default("")
        updated        String  @default("")
        // 首播日期
        air_date       String? @default("")
        // 该季总集数
        episode_count  Float?  @default(0)
        // 季名称
        name           String? @default("")
        // 季描述
        overview       String? @default("")
        // 季海报
        poster_path    String? @default("")
        // 季数
        season_number  Float?  @default(0)
        // tmdb 记录 id
        tmdb_id        Float?  @default(0)
        // tmdb 记录 tv id
        tmdb_tv_id     Float?  @default(0)
        // 关联 searched_tv 表
        searched_tv_id String? @default("")

        @@index([created])
}

model searched_tv {
        id                String  @id
        created           String  @default("")
        updated           String  @default("")
        // tmdb 记录 id
        tmdb_id           Float?  @default(0)
        // 电视剧名称
        name              String? @default("")
        // 电视剧原始名称/外文名称
        original_name     String? @default("")
        // 描述
        overview          String? @default("")
        // 海报地址
        poster_path       String? @default("")
        // 背景图片
        backdrop_path     String? @default("")
        // 首播日期
        first_air_date    String? @default("")
        // 原始语言，可用来区分日剧、国产还是美剧等
        original_language String? @default("")
        // 评分
        popularity        Float?  @default(0)
        // 评分
        vote_average      Float?  @default(0)
        // 评分
        vote_count        Float?  @default(0)

        @@index([created])
}

model searched_tv_with_name {
        id             String  @id
        created        String  @default("")
        updated        String  @default("")
        name           String? @default("")
        original_name  String? @default("")
        searched_tv_id String? @default("")

        @@index([created])
}

// 废弃
model season {
        id        String  @id
        created   String  @default("")
        season    String? @default("")
        updated   String  @default("")
        file_id   String? @default("")
        file_name String? @default("")
        tv_id     String? @default("")

        @@index([created])
}

model shared_file {
        id      String  @id
        created String  @default("")
        updated String  @default("")
        // 分享链接名称
        title   String? @default("")
        // 分享链接
        url     String? @default("")
        // 关联 user 表
        user_id String? @default("")

        @@index([created])
}

model shared_file_in_progress {
        id             String  @id
        created        String  @default("")
        updated        String  @default("")
        // 关联的分享文件夹 file_id
        file_id        String? @default("")
        // 关联的分享文件夹名称
        name           String? @default("")
        // 关联的目标文件夹 file_id
        target_file_id String? @default("")
        // 是否已完结
        complete       Float?  @default(0)
        // 分享文件夹所属 url
        url            String? @default("")
        // 该分享文件夹是否失效
        need_update    Float?  @default(0)
        // 关联 user 表
        user_id        String? @default("")

        @@index([created])
}

// 在后台转存后分享文件夹后，在这里会新增一条记录，下次自动索引网盘时仅索引该表内记录
model tmp_folder {
        id           String  @id
        created      String  @default("")
        updated      String  @default("")
        // 文件夹/文件 名称
        name         String? @default("")
        // 0文件夹 1文件
        type         Float?  @default(0)
        // 父文件夹路径
        parent_paths String? @default("")
        // 关联 user 表
        user_id      String? @default("")
        // 关联 drive 表
        drive_id     String? @default("")

        @@index([created])
}

model tv {
        id             String  @id
        created        String  @default("")
        updated        String  @default("")
        // 根据文件夹/文件名称推测出的电视剧名称
        name           String? @default("")
        // 根据文件夹/文件名称推测出的电视剧原始名称或外文译名
        original_name  String? @default("")
        // 从哪个文件夹推断
        file_id        String? @default("")
        // 从哪个文件夹推断
        file_name      String? @default("")
        // 正确的电视剧名称
        correct_name   String? @default("")
        // 是否隐藏
        hidden         Float?  @default(0)
        // 关联 searched_tv 表
        searched_tv_id String? @default("")
        // 关联 user 表
        user_id        String? @default("")
        // 关联 drive 表
        drive_id       String? @default("")

        @@index([created])
}

model tv_need_complete {
        id                 String  @id
        created            String  @default("")
        updated            String  @default("")
        // 总集数
        episode_count      Float?  @default(0)
        // 当前集数
        cur_count          Float?  @default(0)
        // 关联 user 表
        user_id            String? @default("")
        // 关联 searched_tv 表
        searched_tv_id     String? @default("")
        // 关联 searchd_season 表
        searched_season_id String? @default("")

        @@index([created])
}

model user {
        id                     String  @id
        created                String  @default("")
        updated                String  @default("")
        avatar                 String? @default("")
        email                  String  @default("")
        emailVisibility        Boolean @default(false)
        lastResetSentAt        String  @default("")
        lastVerificationSentAt String  @default("")
        name                   String? @default("")
        passwordHash           String
        tokenKey               String  @unique(map: "__pb_users_auth__tokenKey_idx")
        username               String  @unique(map: "__pb_users_auth__username_idx")
        verified               Boolean @default(false)

        @@index([created])
}

model admin {
        id              String @id
        avatar          Int    @default(0)
        email           String @unique(map: "sqlite_autoindex__admins_2")
        tokenKey        String @unique(map: "sqlite_autoindex__admins_3")
        passwordHash    String
        lastResetSentAt String @default("")
        created         String @default("")
        updated         String @default("")

        @@map("admin")
}
